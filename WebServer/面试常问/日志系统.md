---
title: 日志系统
updated: 2025-04-14T21:59:42
created: 2025-04-14T21:57:41
---

**1、说下你的日志系统的运行机制？**
使用**单例模式**创建日志系统，对服务器运行状态、错误信息和访问数据进行记录，该系统可以实现**按天**分类，**超行**分类功能，可以根据实际情况分别使用同步和异步写入两种方式。
其中异步写入方式，将生产者-消费者模型封装为阻塞队列，创建一个写线程，工作线程将要写的内容 push 进队列，写线程从队列中取出内容，写入日志文件。
**2、为什么要异步？和同步的区别是什么？**
同步方式写入日志时会产生比较多的系统调用，若是某条日志信息过大，会阻塞日志系统，造成系统瓶颈。异步方式采用生产者-消费者模型，具有较高的并发能力。
**生产者-消费者模型**，并发编程中的经典模型。
以多线程为例，为了实现线程间数据同步，生产者线程与消费者线程共享一个缓冲区，其中生产者线程往缓冲区中 push 消息，消费者线程从缓冲区中 pop 消息。
**阻塞队列**，将生产者-消费者模型进行封装，使用循环数组实现队列，作为两者共享的缓冲区。
**异步日志**，将所写的日志内容先存入**阻塞队列**，写线程从阻塞队列中取出内容，写入日志。
可以提高系统的并发性能。
**同步日志**，日志写入函数与工作线程串行执行，由于涉及到 I/O 操作，当单条日志比较大的时候，同步模式会阻塞整个处理流程，服务器所能处理的并发能力将有所下降，尤其是在峰值的时候，写日志可能成为系统的瓶颈。
写入方式通过初始化时**是否设置队列大小**（表示在队列中可以放几条数据）来判断，若队列大小为 0，则为同步，否则为异步。
若异步,则将日志信息加入阻塞队列,同步则加锁向文件中写
4、关于该项目用到的设计模式
（1）单例模式：单例对象的类只能允许一个实例存在，并提供一个访问它的全局访问点，该实例被所有程序模块共享。主要解决一个全局使用的类频繁的创建和销毁的问题，是一种创建型模式，提供了一种创建对象的最佳方式。
（2）单例模式三要素：
1）单例类只能有一个实例。
2）单例类必须自己创建自己的唯一实例。
3）单例类必须给所有其他对象提供这一实例。
（3）单例设计模式的优缺点
优点：
1）单例模式可以保证内存里只有一个实例，减少了内存的开销。
2）可以避免对资源的多重占用。（比如写文件操作）
3）单例模式设置全局访问点，可以优化和共享资源的访问。
缺点：
1）单例模式一般没有接口，不能继承，扩展困难。如果要扩展，则除了修改原来的代码，没有第二种途径，违背开闭原则。
2）在并发测试中，单例模式不利于代码调试。在调试过程中，如果单例中的代码没有执行完，也不能模拟生成一个新的对象。
3）单例模式的功能代码通常写在一个类中，如果功能设计不合理，则很容易违背单一职责原则。
（4）C++单例设计模式的实现两步骤
1）私有化构造函数，这样别处的代码就无法通过调用该类的构造函数来实例化该类的对象，只有通过该类提供的静态方法来得到该类的唯一实例；
2）通过局部静态变量，利用其只初始化一次的特点，返回静态对象成员。
（5）单例设计模式的种类
1）懒汉式：获取该类的对象时才创建该类的实例
2）饿汉式：获取该类的对象之前已经创建好该类的实例
