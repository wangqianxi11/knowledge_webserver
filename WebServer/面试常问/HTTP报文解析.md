---
title: HTTP报文解析
updated: 2025-04-14T21:53:08
created: 2025-04-14T21:45:25
---

# 1、用了状态机啊，为什么要用状态机？
在逻辑处理模块中，响应HTTP请求采用主从状态机来完成
传统的控制流程都是按照顺序执行的，状态机能**处理任意顺序的事件**，并能提供有意义的响应—即使这些事件发生的顺序和预计的不同。
项目中使用主从状态机的模式进行解析，从状态机（parse_line）负责读取报文的一行，主状态机负责对该行数据进行解析，主状态机内部调用从状态机，从状态机驱动主状态机。每解析一部分都会将整个请求的m_check_state状态改变，状态机也就是根据这个状态来进行不同部分的解析跳转的

# 3、状态机的缺点
状态机的缺点就是**性能比较低**，一般一个状态做一个事情，性能比较差，在追求高性能的场景下一般不用，高性能场景一般使用**流水线设计**

# 6、GET和POST的区别
（1）get主要用来获取数据，post主要用来提交或修改数据。
（2）get的参数有长度限制，最长2048字节，而post没有限制。
（3）get是明文传输，可以直接通过url看到参数信息，post是放在请求体中，除非用工具才能看到。
（4）get的参数会附加在url中，以 " ？"分割url和传输数据，多个参数用 "&"连接， 而post会把参数放在http请求体中。
（5）get请求会保存在浏览器历史记录中，也可以保存在web服务器日志中。 （6）get请求会被浏览器主动缓存，而post不会，除非手动设置。
（7）get在浏览器回退时是无害的，而post会再次提交请求。
（8）get请求只能进行url编码，而post支持多种编码方式。
（9）get请求的参数数据类型只接受ASCII字符，而post没有限制。
（10）get是幂等的，而post不是幂等的。 幂等性：对同一URL的多个请求应该返回同样的结果。

**HTTP常见字段有哪些？**
HOST，给出请求资源所在服务器的域名。
 User-Agent，HTTP客户端程序的信息，该信息由你发出请求使用的浏览器来定义,并且在每个请求中自动发送等。
 connection，连接管理，可以是Keep-Alive或close。
 content-length字段，这里用于读取post请求的消息体长度
Content-Type字段：用于服务器回应时，告诉客户端，本次数据是什么格式

（2）HTTP响应报文：状态行、响应头部、响应空行、响应正文
状态行：协议版本\|空格\|状态码\|空格\|状态码描述\|回车符\|换行符

# 12、一次完整 HTTP 请求所经历的步骤
（当我们在 web 浏览器的地址栏中输入：www.baidu.com，然后回车，到底发生了什么？）
由域名→ IP 地址 寻找 IP 地址的过程依次经过了浏览器缓存、系统缓存、hosts 文件、路由器缓存、 递归搜索根域名服务器（DNS解析）。
建立 TCP/IP 连接（三次握手具体过程）。
由浏览器发送一个 HTTP 请求。
经过路由器的转发，通过服务器的防火墙，该 HTTP 请求到达了服务器。
服务器处理该 HTTP 请求，返回一个 HTML 文件。
浏览器解析该 HTML 文件，并且显示在浏览器端。
服务器关闭 TCP 连接（四次挥手具体过程）。

# 15、 Web服务器如何接收客户端发来的HTTP请求报文
Web服务器端通过socket监听来自用户的请求。远端的很多用户会尝试去connect()这个WebServer上正在listen的这个端口，而监听到的这些连接会排队等待被accept()。由于用户连接请求是随机到达的异步事件，每当监听socket（listenfd）listen到新的客户连接并且放入监听队列，我们都需要告诉我们的Web服务器有连接来了，accept这个连接，并分配一个逻辑单元来处理这个用户请求。而且，我们在处理这个请求的同时，还需要继续监听其他客户的请求并分配其另一逻辑单元来处理。这里，服务器通过**epoll**这种I/O复用技术（还有select和poll）来实现对监听socket（listenfd）和连接socket（客户请求）的同时监听。

