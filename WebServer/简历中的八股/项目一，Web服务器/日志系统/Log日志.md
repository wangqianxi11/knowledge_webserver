---
title: Log日志
updated: 2025-05-19T22:35:59
created: 2025-04-07T15:58:39
---

单例模式与阻塞队列，实现异步的日志系统。

**一、使用阻塞队列的核心动机**
1.  **实现“异步日志写入”机制**
    - **主线程不直接写日志文件，而是将日志消息放入阻塞队列**
    - **后台日志线程从队列中取出日志消息并写入磁盘**
    - **这样可以避免主线程频繁阻塞在 I/O 操作，提高系统响应速度和吞吐量**
2.  **线程安全的生产者-消费者模型**
    - **阻塞队列天然支持多个线程安全地并发访问**
    - **主线程作为“生产者”，日志线程作为“消费者”，无锁或轻锁实现，简洁稳定**
3.  **流量控制（背压）机制**
    - **当日志写入过快，超过队列容量时，主线程会阻塞等待消费者消费日志**
    - **避免日志过量产生导致内存暴涨，形成自动限流**

**二、与非阻塞队列的对比分析**
| **维度** | **阻塞队列** | **非阻塞队列** |
|----|----|----|
| **性能** | 高并发下可能稍慢，但更稳定 | 高速写入，但需手动处理边界情况 |
| **资源控制** | 有限队列，写满则自动等待（背压） | 无法自动限流，易OOM |
| **线程行为** | 写满时挂起写线程 | 写满时需立即丢弃或重试（复杂） |
| **实现复杂度** | 简洁，常用 STL queue + mutex/cond | 需细致管理 CAS、自旋、失败重试等 |
| **适用场景** | 日志量中等、容忍短暂阻塞 | 对日志实时性要求极高、超低延迟系统 |

