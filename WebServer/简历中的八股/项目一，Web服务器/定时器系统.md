---
title: 定时器系统
updated: 2025-06-20T17:43:50
created: 2025-04-29T15:17:50
---

### 定时器的工作原理
利用结构体将定时事件封装。
服务器主循环为每个连接创建一个定时器，对每个连接进行定时。
利用alarm函数周期性的触发SIGALRM信号，信号处理函数利用管道通知主循环。

### 为什么要用定时器
**为了定期删除非活跃连接，防止连接资源的浪费**
- 非活跃：浏览器与服务器端建立连接后，长时间不交换数据，一直占用服务器端的文件描述符，导致资源的浪费
- 定时事件：固定一段时间后触发某段代码，由该段代码处理一个事件
### 最小堆优化的时间复杂度和工作原理
添加：o(log n),删除：o(1)
**工作原理**
将所有定时器中超时时间最小的一个定时器的超时值，作为定时任务处理函数的定时值。这样，一旦定时任务处理函数被调用，超时时间最小的定时器必然到期
从剩余的定时器中找出超时时间最小的一个，设置为下一次定时任务处理函数的定时值

==优化资源利用率？==
