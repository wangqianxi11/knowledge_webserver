---
title: HTTPS协议
updated: 2025-06-15T15:53:13
created: 2025-04-28T14:39:52
---

## SSL/TLS

**SSL/TLS 是 TCP/IP 协议中的会话层，用于认证用户和服务器，加解密数据以及维护数据的完整性，确保数据在传输过程中不会被修改**
**分为对称加密和非对称加密两种方式**


### 对称加密

指加密和解密都用同一份密钥

- **优点：运算速度快**
- **缺点：无法将密钥安全的传给对方**

### 非对称加密

非对称加密分为私钥和公钥，用私钥加密后需要公钥解密，公钥加密后用私钥解密

- **优点：可以安全的将公钥传给对方**
- **运算速度慢**

<b><p style = "color:red">非对称加密解决了最关键的密钥交换问题，而后续使用对称加密是为了效率。</p></b>

## HTTPS 建立连接

### 在浏览器地址栏中键入”https“开头的 URI，会发生什么？

- 首先从 URI 里提出协议和域名，用 DNS 解析域名，得到目标的 IP 地址，使用三次握手与网站建立 TCP 连接
  在 http 协议中，建立连接后，浏览器会立即发送请求报文。但是在 https 协议中，需要**另外一个“握手”过程**，在 TCP 建立安全连接之后才是收发 HTTP 报文。

1.  HTTPS 基于 TCP，首先通过三次握手建立可靠的传输层连接
2.  TLS 握手在 TCP 连接之上建立，核心目标是： - 协商加密算法（如 AES、RSA、ECDHE） - 验证服务器身份（证书） - 生成会话密钥（用于对称加密通信）
    **以 TLS1.2 为例**
3.  client hello
    - 客户端发送支持的信息：TLS 版本、支持加密的套件、随机数用于后续密钥生成
4.  server hello
    - 服务器选择并返回：确定的 TLS 版本和加密套件、随机数、服务器证书（包含公钥和域名信息）
5.  证书验证（客户端）
    - 客户端验证证书：是否由信任的 CA 签发、过期和吊销；域名是否匹配
6.  密钥交换（Pre-Master Secret 生成）
    - 客户端生成一个 Pre-Master Secret，用服务器公钥加密后发送
7.  server 确认密钥
8.  生成会话密钥
9.  加密通信

## HTTPS的混合加密解析
### 第一步：非对称加密（建立安全）

- **目的**：安全地交换一个“对称加密的密钥”（通常称为“会话密钥”或“预主密钥”）。

- **过程**：

    - 服务器将自己的<b>公钥（包含在数字证书中）</b>发送给客户端。

    - 客户端生成一个<b>随机的会话密钥。</b>

    - 客户端<b>用服务器的公钥加密这个会话密钥</b>，然后发送给服务器。

    - 服务器用<b>自己的私钥解密，得到明文的会话密钥。</b>

为什么安全？ 即使攻击者截获了第3步加密后的会话密钥，由于他没有服务器的私钥，也无法解密得到真正的密钥。

### 第二步：对称加密（传输数据）

- **目的**：使用第一步协商好的、只有双方知道的会话密钥，来加密和解密所有后续的通信数据。

- **过程**：客户端和服务器都使用这个**会话密钥**，利用AES等高效的对称加密算法，对HTTP请求和响应的内容进行加密和解密。

为什么高效？ 对称加密速度极快，可以轻松处理网页、图片、视频等海量数据。

### HTTPS不使用两次非对称加密，是因为：

- 一次非对称加密已经完美地解决了最核心的“密钥交换”安全问题。

- 后续使用对称加密是为了获得极高的性能，以支撑现代互联网的海量数据传输。

- 再用非对称加密传输数据只会造成巨大的性能浪费，而不会带来任何额外的安全好处。

## HTTPS 一定安全吗

**1. 客户端/浏览器被劫持**

- 比如电脑中了木马，劫持浏览器或篡改证书信任链，即使是 HTTPS 也无法保障数据安全。
  
**2. 服务器端存在漏洞**
- HTTPS 只能保证数据传输安全，**不能防止网站本身有 SQL 注入、XSS、逻辑漏洞等安全问题**。

**3. 证书伪造或 CA 信任被滥用**
- 如果恶意中间人获得了一个被信任的 CA 证书（例如某些政府或黑客攻击了 CA），就能发起伪造证书的中间人攻击。
  
**4. DNS 劫持**
- 用户访问的域名可能被劫持到恶意 IP，即使 HTTPS 证书正确，用户还是可能被钓鱼。
  
**5. HTTPS 降级攻击**
- 如果服务器支持不安全的旧版协议（如 TLS 1.0），可能被迫降级到不安全连接。
