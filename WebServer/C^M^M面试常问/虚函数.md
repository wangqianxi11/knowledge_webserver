---
title: 虚函数
updated: 2025-08-22T16:15:52
created: 2025-04-15T10:44:20
---

在C++中，虚函数的实现原理基于两个关键概念：虚函数表和虚函数指针
- **虚函数表**：**每个包含虚函数的类都会生成一个虚函数表**，其中存储着该类中所有虚函数的地址。虚函数表是一个由指针构成的数组，每个指针指向一个虚函数的实现代码。
- **虚函数指针**：在对象的内存布局中，编译器会添加一个额外的指针，称为虚函数指针或虚表指针。这个指针指向该对象对应的虚函数表，从而让程序能够动态的调用虚函数。
**当一个基类指针或引用调用虚函数时，编译器会使用虚表指针来查找该对象对应的虚函数表，并根据函数在虚函数表中的位置来调用正确的虚函数。**

在编译阶段生成，虚函数和普通函数一样存放在代码段，只是它的指针又存放在了虚表之中

所谓虚函数就是在基类定义一个未实现的函数名，为了提高程序的可读性，建议后代中虚函数都加上[virtual](https://so.csdn.net/so/search?q=virtual&spm=1001.2101.3001.7020)关键字。一般格式：
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="header">
<th><p>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>5</p>
<p>6</p>
<p>7</p>
<p>8</p></th>
<th><p>class base</p>
<p>{</p>
<p>public:</p>
<p>base();</p>
<p>virtual void test(); //定义的一个虚函数</p>
<p>private:</p>
<p>char *basePStr;</p>
<p>};</p></th>
</tr>
</thead>
<tbody>
</tbody>
</table>

常见用法：声明基类指针，利用指针指向任意一个子类对象，调用相关的虚函数，**动态绑定**，由于编写代码时不能确定被调用的是基类函数还是那个派生类函数，所以被称为“”虚“”函数。
**如果没有使用虚函数的话，即没有利用C++多态性，则利用基类指针调用相应的函数的时候，将总被限制在基类函数本身，而无法调用到子类中被重写过的函数。**

