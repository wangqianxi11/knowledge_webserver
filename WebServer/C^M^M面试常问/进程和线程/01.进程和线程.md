---
title: 进程和线程
updated: 2025-08-22T18:46:57
created: 2025-04-15T11:20:25
---

对于进程来说，**子进程是父进程的复制品，从父进程那里获得父进程的数据空间**，堆和栈的复制品。

而线程，相对于进程而言，是一个更加接近于执行体的概念，**可以和同进程的其他线程之间直接共享数据，而且拥有自己的栈空间，拥有独立序列。**

共同点：它们都能提高程序的并发度，提高程序运行效率和响应时间。线程和进程在使用上各有优缺点。
**线程执行开销比较小，但不利于资源的管理和保护，而进程相反。**

同时，线程适合在`SMP机器`上运行，而进程可以跨机器迁移。

他们之间根本区别在于 <strong style="color:red">多进程中每个进程有自己的地址空间，线程则共享地址空间。</strong>所有其他区别都是因为这个区别产生的。比如说：
1.  速度。线程产生的速度快，通讯快，切换快，因为他们处于同一地址空间。
2.  线程的资源利用率好。
3.  线程使用公共变量或者内存的时候需要同步机制，但进程不用。
而他们通信方式的差异也仍然是由于这个根本原因造成的。

### 进程的开销体现在哪里
**涉及硬件、操作系统和软件层面**的多重成本

一、**直接CPU时间开销**：
- 寄存器保存与恢复
  - 进程的上下文（包括程序计数器、栈指针、通用寄存器、浮点寄存器）需要保护到内核栈或进程控制块（PCB）中，新进程的上下文再从PCB加载到CPU。这一过程需要数百到数千个CPU周期
- 内核态切换
  - 切换时需要进入内核态（通过系统调用和中断），涉及权限级别切换（用户态-内核态-用户态）

二、**缓存失效：**
- 缓存污染：新进程的内存访问模式与旧进程不同，导致CPU缓存中原数据失效
- TLB失效：

**三、调度器开销：**
- 内核锁竞争：多核环境，可能因全局锁
### 线程相比进程，开销小在哪里？
- 无需切换地址空间（内存映射不变）
  - 进程切换：进程有独立的虚拟地址空间，切换时需要更换
  - 线程切换：同一进程内的线程共享地址空间，内存访问性能不受影响
- 减少内核态数据结构的更新
  - 进程切换：需要更新新进程控制块的完整状态
  - 线程切换：只需要更新线程控制块
- 缓存局部性更好
- 系统调用和内核介入更少
### CPU常见的调度算法有哪些？
一、 非抢占式调度算法
- 先来先服务（FCFS）
- 最短作业优先（SJF）

二、抢占式调度算法
- 最短剩余时间优先（SRTF）
- 优先级调度
- 时间片轮转

三、多级队列调度

